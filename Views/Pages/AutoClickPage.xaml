<Page x:Class="ToolVip.Views.Pages.AutoClickPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:local="clr-namespace:ToolVip.Views.Pages"
      xmlns:help="clr-namespace:ToolVip.Helpers"
      Title="Auto OCR"
      mc:Ignorable="d"
      ScrollViewer.CanContentScroll="False">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Margin="0,0,0,15">
            <TextBlock Text="OCR Auto Clicker" FontSize="24" FontWeight="Bold"/>
            <ui:Card Padding="10,5" HorizontalAlignment="Right" Background="#20000000">
                <TextBlock Text="{Binding ViewModel.CurrentMousePos}" FontWeight="SemiBold" Foreground="Red"/>
            </ui:Card>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <ui:Card Grid.Column="0" Margin="0,0,10,0" VerticalAlignment="Top">
                <StackPanel>
                    <TextBlock Text="1. Vùng quét &amp; Từ khóa" FontWeight="Bold" Margin="0,0,0,10"/>

                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Margin="0,0,5,0">
                            <TextBlock Text="X1" Margin="0,0,0,4" Foreground="Gray"/>
                            <ui:TextBox Text="{Binding ViewModel.X1}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="0,0,5,0">
                            <TextBlock Text="Y1" Margin="0,0,0,4" Foreground="Gray"/>
                            <ui:TextBox Text="{Binding ViewModel.Y1}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="0,0,5,0">
                            <TextBlock Text="X2" Margin="0,0,0,4" Foreground="Gray"/>
                            <ui:TextBox Text="{Binding ViewModel.X2}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="3">
                            <TextBlock Text="Y2" Margin="0,0,0,4" Foreground="Gray"/>
                            <ui:TextBox Text="{Binding ViewModel.Y2}"/>
                        </StackPanel>
                    </Grid>

                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Từ khóa cần tìm" Margin="0,0,0,4" Foreground="Gray"/>
                        <ui:TextBox Text="{Binding ViewModel.Keyword}" 
                                    PlaceholderText="Nhập chữ..."
                                    Icon="Search24"/>
                    </StackPanel>

                    <CheckBox Content="Chính xác 100%" IsChecked="{Binding ViewModel.IsExactMatch}"/>
                </StackPanel>
            </ui:Card>

            <ui:Card Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Top">
                <StackPanel>
                    <TextBlock Text="2. Hành động khi thấy" FontWeight="Bold" Margin="0,0,0,10"/>

                    <RadioButton Content="Click vào vị trí tìm thấy" IsChecked="{Binding ViewModel.IsClickOCR}" GroupName="ActMode" Margin="0,0,0,5"/>
                    <RadioButton Content="Chạy kịch bản bên dưới" IsChecked="{Binding ViewModel.IsClickCustom}" GroupName="ActMode" Margin="0,0,0,10"/>

                    <Grid IsEnabled="{Binding ViewModel.IsClickCustom}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Width="60" Margin="0,0,5,0">
                            <TextBlock Text="X" Margin="0,0,0,4" Foreground="Gray"/>
                            <ui:TextBox Text="{Binding ViewModel.NewStepX}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Width="60" Margin="0,0,5,0">
                            <TextBlock Text="Y" Margin="0,0,0,4" Foreground="Gray"/>
                            <ui:TextBox Text="{Binding ViewModel.NewStepY}" />
                        </StackPanel>

                        <StackPanel Grid.Column="2" Width="80" Margin="0,0,5,0">
                            <TextBlock Text="Delay(ms)" Margin="0,0,0,4" Foreground="Gray"/>
                            <ui:TextBox Text="{Binding ViewModel.NewStepDelay}" />
                        </StackPanel>

                        <ui:Button Grid.Column="3" 
                                   Command="{Binding ViewModel.AddStepCommand}"
                                   VerticalAlignment="Bottom" Appearance="Secondary"
                                   Icon="Add24"/>
                    </Grid>

                    <Grid Margin="0,10,0,0">
                        <ui:Button Content="Xóa Script" 
                                    Appearance="Danger" HorizontalAlignment="Right"
                                    Command="{Binding ViewModel.ClearStepsCommand}"
                                    IsEnabled="{Binding ViewModel.IsClickCustom}"
                                    Icon="Delete24"/>
                    </Grid>
                </StackPanel>
            </ui:Card>
        </Grid>

        <Grid Grid.Row="2" Margin="0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="1.5*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Margin="0,0,10,0" 
                    BorderBrush="{DynamicResource ControlElevationBorderBrush}" BorderThickness="1" CornerRadius="8"
                    IsEnabled="{Binding ViewModel.IsClickCustom}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Kịch bản (Script)" FontWeight="SemiBold" Margin="10"/>
                    <ui:ListView Grid.Row="1" ItemsSource="{Binding ViewModel.ScriptSteps}" DisplayMemberPath="DisplayText" Margin="5"/>
                </Grid>
            </Border>

            <Border Grid.Column="1" Margin="10,0,0,0"
                    BorderBrush="{DynamicResource ControlElevationBorderBrush}" BorderThickness="1" CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Nhật ký (Log)" FontWeight="SemiBold" Margin="10"/>
                    <TextBox Grid.Row="1" Text="{Binding ViewModel.LogText}" 
                             IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" 
                             TextWrapping="Wrap"
                             FontFamily="Consolas"
                             BorderThickness="0"
                             Background="Transparent"
                             Margin="5"/>
                </Grid>
            </Border>
        </Grid>

        <Grid Grid.Row="3">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <ui:Button Content="Test Quét Thử" 
                           Command="{Binding ViewModel.TestOcrCommand}"
                           Margin="0,0,10,0"
                           IsEnabled="{Binding ViewModel.IsNotRunning}"
                           Icon="ScanText24"/>

                <ui:Button Content="{Binding ViewModel.IsRunning, Converter={x:Static help:RunStatusToStringConverter.Instance}}" 
                           Appearance="{Binding ViewModel.IsRunning, Converter={x:Static help:RunStatusToAppearanceConverter.Instance}}"
                           Command="{Binding ViewModel.ToggleRunCommand}"
                           Width="150" Height="40"
                           Icon="Play24"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>